import{a as q,t as I,d as ye,h as He,c as De}from"../chunks/disclose-version.CYEZbGRd.js";import{i as X}from"../chunks/legacy.Dizh_e1X.js";import{aM as Be,X as Le,u as Ge,b as Ne,a8 as Re,B as Fe,p as j,l as C,i as fe,c as b,r as g,s as M,k as e,t as H,a as U,m as T,j as p,ab as Y,T as te,aw as se,az as Ke,aN as G,$ as Oe,aO as Qe,f as be,aP as We}from"../chunks/utils.DXvTgAFw.js";import{l as Xe,s as Z,e as W}from"../chunks/render.BS6rv_sO.js";import{i as K,s as ke,a as Q}from"../chunks/store.DLGdLQ_h.js";import{s as ae,t as V,e as je,a as _e,z as Ue,A as Je,C as Ye,D as Ze,B as me,E as we,F as et,G as tt,g as st,l as at}from"../chunks/glyphs.Cou4yDk0.js";import{b as re}from"../chunks/this.DCzmdEcR.js";import{p as S}from"../chunks/props.Ce0yfSwg.js";import{o as ge}from"../chunks/index-client.SJPFcUSQ.js";import{g as ne,b as pe,H as nt,q as N,u as rt,t as it}from"../chunks/times.Dj0CMPb8.js";import{s as xe,c as ot}from"../chunks/settings.kxs38m7w.js";import{g as lt}from"../chunks/entry.Dn_mc9az.js";function ct(a,s,i=s){var c=Be();Xe(a,"input",l=>{var r=l?a.defaultValue:a.value;if(r=ve(a)?de(r):r,i(r),c&&r!==(r=s())){var h=a.selectionStart,u=a.selectionEnd;a.value=r??"",u!==null&&(a.selectionStart=h,a.selectionEnd=Math.min(u,a.value.length))}}),(Le&&a.defaultValue!==a.value||Ge(s)==null&&a.value)&&i(ve(a)?de(a.value):a.value),Ne(()=>{var l=s();ve(a)&&l===de(a.value)||a.type==="date"&&!l&&!a.value||l!==a.value&&(a.value=l??"")})}function ve(a){var s=a.type;return s==="number"||s==="range"}function de(a){return a===""?null:+a}function J(a,s,i){var c=Fe(a,s);c&&c.set&&(a[s]=i,Re(()=>{a[s]=null}))}function ut(a){return function(...s){var i=s[0];return i.preventDefault(),a==null?void 0:a.apply(this,s)}}var vt=I("<div> </div>"),dt=I('<div class="quiz-item-wrapper svelte-2386oy"><div class="quiz-item svelte-2386oy"><div class="glyph svelte-2386oy"> </div> <!></div></div>');function _t(a,s){j(s,!1);const i=T(),c=T(),l=T();let r=S(s,"glyph",8),h=S(s,"answered",8,void 0),u=S(s,"is_correct_answer",8,void 0),y=S(s,"is_current",8,!1),m=S(s,"element",12,void 0);C(()=>Y(h()),()=>{p(i,h()!==void 0)}),C(()=>(e(i),Y(u())),()=>{p(c,e(i)?u():!1)}),C(()=>(e(i),Y(u())),()=>{p(l,e(i)?!u():!1)}),fe(),X();var v=dt(),w=b(v),d=b(w),f=b(d,!0);g(d);var o=M(d,2);{var k=_=>{var z=vt();const $=te(()=>`romanisation ${(ne(r())[0].length>3?"long":"")??""} svelte-2386oy`);var R=b(z,!0);H(()=>Z(R,ne(r())[0])),g(z),H(()=>ae(z,e($))),q(_,z)};K(o,_=>{e(l)&&_(k)})}g(w),re(w,_=>m(_),()=>m()),g(v),H(()=>{V(w,"has-answer",e(i)),V(w,"is-correct",e(c)),V(w,"is-incorrect",e(l)),V(w,"is-current",y()),Z(f,r())}),q(a,v),U()}var mt=I("<div><!></div>"),pt=I('<section class="quiz-container svelte-vgkonl"><div></div></section>');function ft(a,s){j(s,!1);let i=S(s,"items",8),c=S(s,"current_idx",8),l=T(0),r=T(),h=T(!0);async function u(){var f,o;if(await se(),!e(r))return;const d=e(r).querySelectorAll(".quiz-content > .quiz-glyph");p(l,0);for(let k=0;k<c();k++)p(l,e(l)+(((f=d[k])==null?void 0:f.getBoundingClientRect().width)||0));p(l,e(l)+(((o=d[c()])==null?void 0:o.offsetWidth)||0)/2)}async function y(){p(h,!0),await se(),setTimeout(()=>{p(h,!1)},2)}ge(()=>{u(),y()});function m(d){let o=Math.abs(d-c());return o=Ue(Je(Ye(o,0,8,0,1)),2)*10,o}window.addEventListener("resize",()=>{y()}),C(()=>(Y(i()),Y(c())),()=>{(i()||c())&&u()}),fe(),X();var v=pt(),w=b(v);je(w,7,i,({id:d,glyph:f,answered:o,is_correct_answer:k})=>d,(d,f,o)=>{let k=()=>e(f).glyph,_=()=>e(f).answered,z=()=>e(f).is_correct_answer;var $=mt();const R=te(()=>`filter: blur(calc(${m(e(o))??""}px))`);var O=b($),x=te(()=>e(o)==c());_t(O,{get glyph(){return k()},get answered(){return _()},get is_correct_answer(){return z()},get is_current(){return e(x)}}),g($),H(()=>{ae($,`quiz-glyph ${(e(o)===c()?"current":"")??""} svelte-vgkonl`),_e($,"style",e(R))}),q(d,$)}),g(w),g(v),re(v,d=>p(r,d),()=>e(r)),H(()=>{ae(w,`quiz-content ${(e(h)?"no-transition":"")??""} svelte-vgkonl`),_e(w,"style",`transform: translateX(calc(50vw - ${e(l)??""}px));`)}),q(a,v),U()}var gt=I('<div class="input-container svelte-kap59t"><form class="answer-input content-width svelte-kap59t"><input type="text" class="text-field svelte-kap59t" placeholder="type here..." autocapitalize="none" autocomplete="off" autocorrect="off"></form></div>');function ht(a,s){j(s,!1);const i=ke(),c=()=>Q(xe,"$settings",i);let l=S(s,"onSubmit",8),r=S(s,"input",12,""),h=S(s,"current_glyph",8),u=S(s,"input_element",12);const y=/^\s+$/;let m=T(!1);function v(){pe(r(),h())||p(m,!0),l()(r()),r("")}function w(_){const z=["insertCompositionText","deleteCompositionText"];return _.isComposing||z.includes(_.inputType)}function d(_){const z=_;if(!w(z)&&h()&&z.data!==null){if(r(r().trim()),y.test(z.data)){v();return}pe(r(),h())&&c().auto_submit&&v()}}X();var f=gt(),o=b(f),k=b(o);Ze(k),_e(k,"spellcheck",!1),re(k,_=>u(_),()=>u()),g(o),g(f),H(()=>V(o,"shake-animation-playing",e(m))),ct(k,r),W("input",k,d),W("submit",o,ut(v)),W("animationend",o,()=>p(m,!1)),q(a,f),U()}var yt=I('<span class="tilt-animation-container svelte-pgyicl"><span class="material-symbols-rounded reset-animation-container menu-icon flipped svelte-pgyicl">refresh</span></span>'),bt=I('<span class="material-symbols-rounded menu-icon svelte-pgyicl">help</span>'),wt=I('<section class="menu svelte-pgyicl"><div class="button-container svelte-pgyicl"><a href="setup" class="button svelte-pgyicl" title="Go back"><span class="material-symbols-rounded menu-icon svelte-pgyicl">arrow_back</span></a></div> <div class="button-container svelte-pgyicl"><button type="button" class="button svelte-pgyicl" title="Toggle auto-submit"><span class="material-symbols-rounded reset-animation-container menu-icon svelte-pgyicl">keyboard_double_arrow_up</span></button></div> <div class="button-container tilt svelte-pgyicl"><!></div> <div class="button-container svelte-pgyicl"><!></div></section>');function kt(a,s){j(s,!1);let i=T(!1),c=S(s,"menu_event",8),l=S(s,"is_keyboard_open",8),r=S(s,"auto_submit",8),h=S(s,"show_help",12);X();var u=wt(),y=M(b(u),2),m=b(y);g(y);var v=M(y,2),w=b(v);me(w,{style:"menu-icon",title:"Restart game",$$events:{click:()=>{c()("restart"),p(i,!0)}},children:(o,k)=>{var _=yt(),z=b(_);g(_),W("animationend",z,()=>{p(i,!1)}),q(o,_)},$$slots:{default:!0}}),g(v);var d=M(v,2),f=b(d);me(f,{style:"menu-icon",title:"Help",$$events:{click:()=>h(!h())},children:(o,k)=>{var _=bt();q(o,_)},$$slots:{default:!0}}),g(d),g(u),H(()=>{V(u,"keyboard-open",l()),V(y,"activated",r()),V(v,"reset-animation-playing",e(i))}),W("click",m,()=>{c()("toggle-auto-submit")}),q(a,u),U()}var xt=I('<span class="best-time not-set svelte-1x0vul2">best: --:--.-s</span>'),zt=I('<span class="best-time svelte-1x0vul2">best: <span class="nowrap"> </span></span>'),Tt=I('<div class="stopwatch svelte-1x0vul2"><span><!>s</span> <!></div>');function St(a,s){j(s,!1);let i=S(s,"elapsed_time",12,0),c=S(s,"is_inactive",8,!1),l=S(s,"best_time",24,()=>-1),r=S(s,"time_style",8,"normal"),h=null,u=null;ge(()=>()=>{v()});function y(){h=Date.now(),u=setInterval(()=>{m()},100)}function m(){if(h!==null){const x=Date.now();i(et((x-h)/1e3,2))}else console.log("start_time is null")}function v(){u&&(clearInterval(u),u=null)}function w(){v(),i(0),h=null}function d(){return h!==null}X();var f=Tt(),o=b(f),k=b(o);{var _=x=>{var t=ye("--:--.-");q(x,t)},z=x=>{var t=ye();H(()=>Z(t,we(i()))),q(x,t)};K(k,x=>{c()?x(_):x(z,!1)})}Ke(),g(o);var $=M(o,2);{var R=x=>{var t=xt();q(x,t)},O=x=>{var t=zt(),F=M(b(t)),ie=b(F);H(()=>Z(ie,`${we(l())??""}s`)),g(F),g(t),q(x,t)};K($,x=>{l()<0?x(R):x(O,!1)})}return g(f),H(()=>{ae(o,`time ${r()??""} nowrap svelte-1x0vul2`),V(o,"incorrect-color",r()=="incorrect"),V(o,"new-best-color",r()=="record-set")}),q(a,f),J(s,"startTimer",y),J(s,"updateTime",m),J(s,"stopTimer",v),J(s,"resetTimer",w),J(s,"hasStarted",d),U({startTimer:y,updateTime:m,stopTimer:v,resetTimer:w,hasStarted:d})}var qt=I("<!> <!> <!>",1),Et=I('<span class="button-content svelte-szf12t"><span class="button-text">Summary</span> <span class="material-symbols-rounded icon svelte-szf12t">arrow_forward</span></span>'),Ct=I('<div class="summary-button-container svelte-szf12t"><!></div>'),It=I('<div><div class="contents svelte-szf12t"><div class="top-bar svelte-szf12t"><div><a href="/">glyph-glyph</a> <span class="config-id svelte-szf12t"> </span></div> <!></div> <div class="play-contents svelte-szf12t"><!></div> <!></div> <!></div>');function Ft(a,s){j(s,!1);const i=ke(),c=()=>Q(N,"$quiz",i),l=()=>Q(st,"$game_config",i),r=()=>Q(xe,"$settings",i),h=()=>Q(it,"$times_store",i),u=()=>Q(at,"$glyphs_list",i),y=T(),m=T(),v=T(),w=T(),d=T(),f=T(),o=T();let k=T(!0),_=T(!1),z=T(!1);function $(){window.visualViewport&&p(_,window.visualViewport.height<window.innerHeight)}ge(()=>{window.visualViewport&&(window.visualViewport.addEventListener("resize",$),$());const n=N.subscribe(()=>{p(k,!1)});return G(t,e(t).is_inactive=e(m)>0),()=>{window.visualViewport&&window.visualViewport.removeEventListener("resize",$),n()}});const R=/^[a-z0-9]+$/i;let O=T(),x=T(),t=T({is_enabled:r().stopwatch_enabled}),F=0;function ie(n){var E;switch(n){case"restart":l().path.includes("hangul")&&l().path.includes("syllables")&&tt(),N.reset(),e(t).is_enabled&&((E=e(t).component)==null||E.resetTimer(),G(t,e(t).is_inactive=!1),G(t,e(t).new_record_set=!1),F=0);break;case"toggle-auto-submit":ot()}}async function ze(n){var B,L,A,P;if(!l().is_valid||!e(v))return;e(t).component&&e(t).is_enabled&&!e(t).component.hasStarted()&&e(t).component.startTimer();const E=pe(n,e(v).glyph);if(!E&&n==="")return;(B=e(t).component)==null||B.updateTime();let D=e(t).is_enabled&&e(t).component&&e(t).component.hasStarted()?(e(t).elapsed_time||0)-F:0;if(console.log("time_spent",D),console.log("stopwatch.is_enabled",e(t).is_enabled),console.log("stopwatch.component",e(t).component),console.log("stopwatch.component?.hasStarted()",(L=e(t).component)==null?void 0:L.hasStarted()),console.log("stopwatch.elapsed_time",e(t).elapsed_time),console.log("stopwatch_checkpoint",F),F=e(t).elapsed_time||0,N.updateItem(e(m),Ve=>({...Ve,answered:n,is_correct_answer:E,time_spent:D})),N.updateIndex(We(m)),await se(),e(w)){!e(t).is_inactive&&e(t).is_enabled&&((A=e(t).component)!=null&&A.hasStarted())&&((P=e(t).component)==null||P.stopTimer(),e(d)&&G(t,e(t).new_record_set=rt(e(f),e(t).elapsed_time||0))),N.updateElapsedTime(e(t).elapsed_time||-1),lt("/summary",{state:{elapsed_time:Number(e(t).elapsed_time??0)}});return}await se()}function Te(n){n.isComposing||document.activeElement!==e(x)&&n.key!==" "&&n.key.length===1&&R.test(n.key)&&e(x).focus()}C(()=>N,()=>{console.log(N)}),C(()=>c(),()=>{p(y,c().items)}),C(()=>c(),()=>{p(m,c().current_idx)}),C(()=>(e(y),e(m)),()=>{p(v,e(y)&&e(y)[e(m)])}),C(()=>(e(m),e(y)),()=>{p(w,e(m)>=e(y).length)}),C(()=>(e(y),e(m)),()=>{p(d,e(y).slice(0,e(m)).every(n=>n==null?void 0:n.is_correct_answer))}),C(()=>l(),()=>{p(f,l().id)}),C(()=>r(),()=>{G(t,e(t).is_enabled=r().stopwatch_enabled)}),C(()=>(h(),e(f)),()=>{G(t,e(t).best_time=h().best_times[e(f)])}),C(()=>(e(t),e(d)),()=>{var n;G(t,e(t).time_style=e(t).is_inactive?"inactive":e(t).new_record_set?"record-set":e(d)?(n=e(t).component)!=null&&n.hasStarted()?"inactive":"normal":"incorrect")}),C(()=>(u(),ne),()=>{p(o,`Type the correct answer for the current (underlined) glyph in the
   queue.

For example for `+u()[0]+', type "'+ne(u()[0])[0]+`" 

There are buttons for restarting and for toggling the auto-submit mechanism 
   (automatically submits a correct answer)`)}),fe(),X();var oe=It();He(n=>{Oe.title="Play · glyph-glyph"}),W("keydown",Qe,Te);var le=b(oe),ce=b(le),ue=b(ce),he=M(b(ue),2),Se=b(he,!0);g(he),g(ue);var qe=M(ue,2);{var Ee=n=>{var E=De(),D=be(E);{var B=L=>{re(St(L,{get is_inactive(){return e(t).is_inactive},get best_time(){return e(t).best_time},get time_style(){return e(t).time_style},get elapsed_time(){return e(t).elapsed_time},set elapsed_time(A){G(t,e(t).elapsed_time=A)},$$legacy:!0}),A=>G(t,e(t).component=A),()=>{var A;return(A=e(t))==null?void 0:A.component})};K(D,L=>{e(t).is_enabled&&L(B)})}q(n,E)};K(qe,n=>{e(k)||n(Ee)})}g(ce);var ee=M(ce,2),Ce=b(ee);{var Ie=n=>{},$e=n=>{var E=qt(),D=be(E);ft(D,{get items(){return e(y)},get current_idx(){return e(m)}});var B=M(D,2),L=te(()=>{var P;return(P=e(v))==null?void 0:P.glyph});ht(B,{onSubmit:ze,get current_glyph(){return e(L)},get input(){return e(O)},set input(P){p(O,P)},get input_element(){return e(x)},set input_element(P){p(x,P)},$$legacy:!0});var A=M(B,2);kt(A,{menu_event:ie,get is_keyboard_open(){return e(_)},get auto_submit(){return r().auto_submit},get show_help(){return e(z)},set show_help(P){p(z,P)},$$legacy:!0}),q(n,E)};K(Ce,n=>{e(k)?n(Ie):n($e,!1)})}g(ee);var Ae=M(ee,2);{var Me=n=>{var E=Ct(),D=b(E);me(D,{href:"summary",selected:!0,title:"Summary",$$events:{click:()=>{}},children:(B,L)=>{var A=Et();q(B,A)},$$slots:{default:!0}}),g(E),q(n,E)};K(Ae,n=>{e(w)&&n(Me)})}g(le);var Pe=M(le,2);nt(Pe,{get instructions(){return e(o)},get is_open(){return e(z)},set is_open(n){p(z,n)},$$legacy:!0}),g(oe),H(()=>{Z(Se,l().id),V(ee,"keyboard-open",e(_))}),q(a,oe),U()}export{Ft as component};
