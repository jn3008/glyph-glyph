import{a as z,t as $,d as ye,h as Ve,c as He}from"../chunks/disclose-version.CYEZbGRd.js";import{i as W}from"../chunks/legacy.Dizh_e1X.js";import{aM as Be,X as De,u as Le,b as Ge,a8 as Ne,B as Re,p as X,l as I,i as me,c as w,r as b,s as P,k as e,t as H,a as j,m as x,j as m,ab as U,T as Z,aw as ee,az as Fe,aN as B,$ as Ke,aO as Oe,f as he,aP as Qe}from"../chunks/utils.DXvTgAFw.js";import{l as We,s as J,e as Q}from"../chunks/render.BS6rv_sO.js";import{i as K,s as we,a as O}from"../chunks/store.DLGdLQ_h.js";import{s as te,t as V,e as Xe,a as ve,A as je,C as Ue,D as Je,E as Ye,B as _e,z as be,F as Ze,G as et,g as tt,l as st}from"../chunks/glyphs.HD24VDJ_.js";import{b as ae}from"../chunks/this.DCzmdEcR.js";import{p as q}from"../chunks/props.Ce0yfSwg.js";import{o as pe}from"../chunks/index-client.SJPFcUSQ.js";import{g as se,b as de,H as at,q as F,u as nt,t as rt}from"../chunks/times.DR_-6IxY.js";import{s as ke,c as it}from"../chunks/settings.kxs38m7w.js";import{g as lt}from"../chunks/entry.CaxePC_I.js";function ot(a,t,n=t){var c=Be();We(a,"input",o=>{var r=o?a.defaultValue:a.value;if(r=oe(a)?ce(r):r,n(r),c&&r!==(r=t())){var k=a.selectionStart,u=a.selectionEnd;a.value=r??"",u!==null&&(a.selectionStart=k,a.selectionEnd=Math.min(u,a.value.length))}}),(De&&a.defaultValue!==a.value||Le(t)==null&&a.value)&&n(oe(a)?ce(a.value):a.value),Ge(()=>{var o=t();oe(a)&&o===ce(a.value)||a.type==="date"&&!o&&!a.value||o!==a.value&&(a.value=o??"")})}function oe(a){var t=a.type;return t==="number"||t==="range"}function ce(a){return a===""?null:+a}function ue(a,t,n){var c=Re(a,t);c&&c.set&&(a[t]=n,Ne(()=>{a[t]=null}))}function ct(a){return function(...t){var n=t[0];return n.preventDefault(),a==null?void 0:a.apply(this,t)}}var ut=$("<div> </div>"),vt=$('<div class="quiz-item-wrapper svelte-2386oy"><div class="quiz-item svelte-2386oy"><div class="glyph svelte-2386oy"> </div> <!></div></div>');function _t(a,t){X(t,!1);const n=x(),c=x(),o=x();let r=q(t,"glyph",8),k=q(t,"answered",8,void 0),u=q(t,"is_correct_answer",8,void 0),g=q(t,"is_current",8,!1),_=q(t,"element",12,void 0);I(()=>U(k()),()=>{m(n,k()!==void 0)}),I(()=>(e(n),U(u())),()=>{m(c,e(n)?u():!1)}),I(()=>(e(n),U(u())),()=>{m(o,e(n)?!u():!1)}),me(),W();var p=vt(),y=w(p),l=w(y),d=w(l,!0);b(l);var v=P(l,2);{var h=f=>{var S=ut();const M=Z(()=>`romanisation ${(se(r())[0].length>3?"long":"")??""} svelte-2386oy`);var T=w(S,!0);H(()=>J(T,se(r())[0])),b(S),H(()=>te(S,e(M))),z(f,S)};K(v,f=>{e(o)&&f(h)})}b(y),ae(y,f=>_(f),()=>_()),b(p),H(()=>{V(y,"has-answer",e(n)),V(y,"is-correct",e(c)),V(y,"is-incorrect",e(o)),V(y,"is-current",g()),J(d,r())}),z(a,p),j()}var dt=$("<div><!></div>"),mt=$('<section class="quiz-container svelte-vgkonl"><div></div></section>');function pt(a,t){X(t,!1);let n=q(t,"items",8),c=q(t,"current_idx",8),o=x(0),r=x(),k=x(!0);async function u(){var d,v;if(await ee(),!e(r))return;const l=e(r).querySelectorAll(".quiz-content > .quiz-glyph");m(o,0);for(let h=0;h<c();h++)m(o,e(o)+(((d=l[h])==null?void 0:d.getBoundingClientRect().width)||0));m(o,e(o)+(((v=l[c()])==null?void 0:v.offsetWidth)||0)/2)}async function g(){m(k,!0),await ee(),setTimeout(()=>{m(k,!1)},2)}pe(()=>{u(),g()});function _(l){let v=Math.abs(l-c());return v=je(Ue(Je(v,0,8,0,1)),2)*10,v}window.addEventListener("resize",()=>{g()}),I(()=>(U(n()),U(c())),()=>{(n()||c())&&u()}),me(),W();var p=mt(),y=w(p);Xe(y,7,n,({id:l,glyph:d,answered:v,is_correct_answer:h})=>l,(l,d,v)=>{let h=()=>e(d).glyph,f=()=>e(d).answered,S=()=>e(d).is_correct_answer;var M=dt();const T=Z(()=>`filter: blur(calc(${_(e(v))??""}px))`);var E=w(M),D=Z(()=>e(v)==c());_t(E,{get glyph(){return h()},get answered(){return f()},get is_correct_answer(){return S()},get is_current(){return e(D)}}),b(M),H(()=>{te(M,`quiz-glyph ${(e(v)===c()?"current":"")??""} svelte-vgkonl`),ve(M,"style",e(T))}),z(l,M)}),b(y),b(p),ae(p,l=>m(r,l),()=>e(r)),H(()=>{te(y,`quiz-content ${(e(k)?"no-transition":"")??""} svelte-vgkonl`),ve(y,"style",`transform: translateX(calc(50vw - ${e(o)??""}px));`)}),z(a,p),j()}var ft=$('<form class="answer-input content-width svelte-i9oslv"><input type="text" class="text-field svelte-i9oslv" placeholder="type here..." autocapitalize="none" autocomplete="off" autocorrect="off"></form>');function gt(a,t){X(t,!1);const n=we(),c=()=>O(ke,"$settings",n);let o=q(t,"onSubmit",8),r=q(t,"input",12,""),k=q(t,"current_glyph",8),u=q(t,"input_element",12);const g=/^\s+$/;let _=x(!1);function p(){de(r(),k())||m(_,!0),o()(r()),r("")}function y(h){const f=["insertCompositionText","deleteCompositionText"];return h.isComposing||f.includes(h.inputType)}function l(h){const f=h;if(!y(f)&&k()&&f.data!==null){if(r(r().trim()),g.test(f.data)){p();return}de(r(),k())&&c().auto_submit&&p()}}W();var d=ft(),v=w(d);Ye(v),ve(v,"spellcheck",!1),ae(v,h=>u(h),()=>u()),b(d),H(()=>V(d,"shake-animation-playing",e(_))),ot(v,r),Q("input",v,l),Q("submit",d,ct(p)),Q("animationend",d,()=>m(_,!1)),z(a,d),j()}var yt=$('<span class="tilt-animation-container svelte-pgyicl"><span class="material-symbols-rounded reset-animation-container menu-icon flipped svelte-pgyicl">refresh</span></span>'),ht=$('<span class="material-symbols-rounded menu-icon svelte-pgyicl">help</span>'),bt=$('<section class="menu svelte-pgyicl"><div class="button-container svelte-pgyicl"><a href="setup" class="button svelte-pgyicl" title="Go back"><span class="material-symbols-rounded menu-icon svelte-pgyicl">arrow_back</span></a></div> <div class="button-container svelte-pgyicl"><button type="button" class="button svelte-pgyicl" title="Toggle auto-submit"><span class="material-symbols-rounded reset-animation-container menu-icon svelte-pgyicl">keyboard_double_arrow_up</span></button></div> <div class="button-container tilt svelte-pgyicl"><!></div> <div class="button-container svelte-pgyicl"><!></div></section>');function wt(a,t){X(t,!1);let n=x(!1),c=q(t,"menu_event",8),o=q(t,"is_keyboard_open",8),r=q(t,"auto_submit",8),k=q(t,"show_help",12);W();var u=bt(),g=P(w(u),2),_=w(g);b(g);var p=P(g,2),y=w(p);_e(y,{style:"menu-icon",title:"Restart game",$$events:{click:()=>{c()("restart"),m(n,!0)}},children:(v,h)=>{var f=yt(),S=w(f);b(f),Q("animationend",S,()=>{m(n,!1)}),z(v,f)},$$slots:{default:!0}}),b(p);var l=P(p,2),d=w(l);_e(d,{style:"menu-icon",title:"Help",$$events:{click:()=>k(!k())},children:(v,h)=>{var f=ht();z(v,f)},$$slots:{default:!0}}),b(l),b(u),H(()=>{V(u,"keyboard-open",o()),V(g,"activated",r()),V(p,"reset-animation-playing",e(n))}),Q("click",_,()=>{c()("toggle-auto-submit")}),z(a,u),j()}var kt=$('<span class="best-time not-set svelte-97rpgf">best: --:--.-s</span>'),xt=$('<span class="best-time svelte-97rpgf">best: <span class="nowrap svelte-97rpgf"> </span></span>'),qt=$('<div class="stopwatch svelte-97rpgf"><span><!>s</span> <!></div>');function Tt(a,t){X(t,!1);let n=q(t,"elapsed_time",12,0),c=q(t,"is_paused",12,!0),o=q(t,"is_inactive",8,!1),r=q(t,"best_time",24,()=>-1),k=q(t,"time_style",8,"normal"),u=null;pe(()=>()=>{_()});function g(){c(!1),u||(u=setInterval(()=>{n(n()+.1),n(Ze(n(),2))},100))}function _(){c(!0),u&&(clearInterval(u),u=null)}function p(){_(),n(0)}W();var y=qt(),l=w(y),d=w(l);{var v=T=>{var E=ye("--:--.-");z(T,E)},h=T=>{var E=ye();H(()=>J(E,be(n()))),z(T,E)};K(d,T=>{o()?T(v):T(h,!1)})}Fe(),b(l);var f=P(l,2);{var S=T=>{var E=kt();z(T,E)},M=T=>{var E=xt(),D=P(w(E)),s=w(D);H(()=>J(s,`${be(r())??""}s`)),b(D),b(E),z(T,E)};K(f,T=>{r()<0?T(S):T(M,!1)})}return b(y),H(()=>{te(l,`time ${k()??""} nowrap svelte-97rpgf`),V(l,"incorrect-color",k()=="incorrect"),V(l,"new-best-color",k()=="record-set")}),z(a,y),ue(t,"startTimer",g),ue(t,"stopTimer",_),ue(t,"resetTimer",p),j({startTimer:g,stopTimer:_,resetTimer:p})}var zt=$("<!> <!> <!>",1),St=$('<span class="button-content svelte-5rq2i"><span class="button-text">Summary</span> <span class="material-symbols-rounded icon svelte-5rq2i">arrow_forward</span></span>'),Et=$('<div class="summary-button-container svelte-5rq2i"><!></div>'),Ct=$('<div><div class="contents svelte-5rq2i"><div class="top-bar svelte-5rq2i"><div><a href="/">glyph-glyph</a> <span class="config-id svelte-5rq2i"> </span></div> <!></div> <div class="play-contents svelte-5rq2i"><!></div> <!></div> <!></div>');function Rt(a,t){X(t,!1);const n=we(),c=()=>O(F,"$quiz",n),o=()=>O(tt,"$game_config",n),r=()=>O(ke,"$settings",n),k=()=>O(rt,"$times_store",n),u=()=>O(st,"$glyphs_list",n),g=x(),_=x(),p=x(),y=x(),l=x(),d=x(),v=x();let h=x(!0),f=x(!1),S=x(!1);function M(){window.visualViewport&&m(f,window.visualViewport.height<window.innerHeight)}pe(()=>{window.visualViewport&&(window.visualViewport.addEventListener("resize",M),M());const i=F.subscribe(()=>{m(h,!1)});return B(s,e(s).is_inactive=e(_)>0),()=>{window.visualViewport&&window.visualViewport.removeEventListener("resize",M),i()}});const T=/^[a-z0-9]+$/i;let E=x(),D=x(),s=x({is_enabled:r().stopwatch_enabled}),fe=0;function xe(i){var C;switch(i){case"restart":o().path.includes("hangul")&&o().path.includes("syllables")&&et(),F.reset(),e(s).is_enabled&&((C=e(s).component)==null||C.resetTimer(),B(s,e(s).is_inactive=!1),B(s,e(s).new_record_set=!1));break;case"toggle-auto-submit":it()}}async function qe(i){var L,G;if(!o().is_valid||!e(p))return;e(s).is_enabled&&e(s).is_paused&&((L=e(s).component)==null||L.startTimer());const C=de(i,e(p).glyph);if(!C&&i==="")return;let N=e(s).is_enabled?(e(s).elapsed_time||0)-fe:0;if(fe=e(s).elapsed_time||0,F.updateItem(e(_),A=>({...A,answered:i,is_correct_answer:C,time_spent:N})),F.updateIndex(Qe(_)),await ee(),e(y)){!e(s).is_inactive&&e(s).is_enabled&&!e(s).is_paused&&((G=e(s).component)==null||G.stopTimer(),e(l)&&B(s,e(s).new_record_set=nt(e(d),e(s).elapsed_time||0))),F.updateElapsedTime(e(s).elapsed_time||-1),lt("/summary",{state:{elapsed_time:Number(e(s).elapsed_time??0)}});return}await ee()}function Te(i){i.isComposing||document.activeElement!==e(D)&&i.key!==" "&&i.key.length===1&&T.test(i.key)&&e(D).focus()}I(()=>F,()=>{console.log(F)}),I(()=>c(),()=>{m(g,c().items)}),I(()=>c(),()=>{m(_,c().current_idx)}),I(()=>(e(g),e(_)),()=>{m(p,e(g)&&e(g)[e(_)])}),I(()=>(e(_),e(g)),()=>{m(y,e(_)>=e(g).length)}),I(()=>(e(g),e(_)),()=>{m(l,e(g).slice(0,e(_)).every(i=>i==null?void 0:i.is_correct_answer))}),I(()=>o(),()=>{m(d,o().id)}),I(()=>r(),()=>{B(s,e(s).is_enabled=r().stopwatch_enabled)}),I(()=>(k(),e(d)),()=>{B(s,e(s).best_time=k().best_times[e(d)])}),I(()=>(e(s),e(l)),()=>{B(s,e(s).time_style=e(s).is_inactive?"inactive":e(s).new_record_set?"record-set":e(l)?e(s).is_paused?"inactive":"normal":"incorrect")}),I(()=>(u(),se),()=>{m(v,`Type the correct answer for the current (underlined) glyph in the
   queue.

For example for `+u()[0]+', type "'+se(u()[0])[0]+`" 

There are buttons for restarting and for toggling the auto-submit mechanism 
   (automatically submits a correct answer)`)}),me(),W();var ne=Ct();Ve(i=>{Ke.title="Play · glyph-glyph"}),Q("keydown",Oe,Te);var re=w(ne),ie=w(re),le=w(ie),ge=P(w(le),2),ze=w(ge,!0);b(ge),b(le);var Se=P(le,2);{var Ee=i=>{var C=He(),N=he(C);{var L=G=>{ae(Tt(G,{get is_inactive(){return e(s).is_inactive},get best_time(){return e(s).best_time},get time_style(){return e(s).time_style},get elapsed_time(){return e(s).elapsed_time},set elapsed_time(A){B(s,e(s).elapsed_time=A)},get is_paused(){return e(s).is_paused},set is_paused(A){B(s,e(s).is_paused=A)},$$legacy:!0}),A=>B(s,e(s).component=A),()=>{var A;return(A=e(s))==null?void 0:A.component})};K(N,G=>{e(s).is_enabled&&G(L)})}z(i,C)};K(Se,i=>{e(h)||i(Ee)})}b(ie);var Y=P(ie,2),Ce=w(Y);{var Ie=i=>{},$e=i=>{var C=zt(),N=he(C);pt(N,{get items(){return e(g)},get current_idx(){return e(_)}});var L=P(N,2),G=Z(()=>{var R;return(R=e(p))==null?void 0:R.glyph});gt(L,{onSubmit:qe,get current_glyph(){return e(G)},get input(){return e(E)},set input(R){m(E,R)},get input_element(){return e(D)},set input_element(R){m(D,R)},$$legacy:!0});var A=P(L,2);wt(A,{menu_event:xe,get is_keyboard_open(){return e(f)},get auto_submit(){return r().auto_submit},get show_help(){return e(S)},set show_help(R){m(S,R)},$$legacy:!0}),z(i,C)};K(Ce,i=>{e(h)?i(Ie):i($e,!1)})}b(Y);var Ae=P(Y,2);{var Me=i=>{var C=Et(),N=w(C);_e(N,{href:"summary",selected:!0,title:"Summary",$$events:{click:()=>{}},children:(L,G)=>{var A=St();z(L,A)},$$slots:{default:!0}}),b(C),z(i,C)};K(Ae,i=>{e(y)&&i(Me)})}b(re);var Pe=P(re,2);at(Pe,{get instructions(){return e(v)},get is_open(){return e(S)},set is_open(i){m(S,i)},$$legacy:!0}),b(ne),H(()=>{J(ze,o().id),V(Y,"keyboard-open",e(f))}),z(a,ne),j()}export{Rt as component};
